name: Rust

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      
    # build crate
    - name: Build
      run: cargo build --verbose
      
    # run tests
    - name: Run tests
      run: cargo test --verbose
    
    # lint
    - name: Run clippy
      uses: actions-rs/clippy-check@v1.0.5
      with:
        # Arguments for the cargo command
        args: --verbose
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Create a Release
        uses: actions/create-release@v1
        with:
          # The name of the tag. This should come from the webhook payload, `github.GITHUB_REF` when a user pushes a new tag
          tag_name: v${{ github.ref }}
          # The name of the release. For example, `Release v1.0.1`
          release_name: v${{ github.ref }}
      - name: Log in to Crates.io
        run: cargo login ${CRATES_IO_TOKEN}
        env:
          CRATES_IO_TOKEN: ${{ secrets.CRATES_IO_TOKEN }}
      - name: Publish to Crates.io
        run: cargo publish
